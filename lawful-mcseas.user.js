// ==UserScript==
// @name         lawful-mcseas
// @name:en      Lawful MC seas
// @name:zh-CN   ç§©åºå¿ƒæµ·
// @namespace    https://mcseas.club/home.php?mod=space&uid=95082
// @version      0.3.2-alpha
// @author       Miyoi
// @description  æ”¹å–„ã€Œæ··æ²Œå¿ƒæµ·ã€è®ºå›çš„ä½¿ç”¨ä½“éªŒã€‚
// @license      MIT
// @icon         https://mcseas.club/favicon.ico
// @homepage     https://mcseas.club/forum.php?mod=viewthread&tid=50579
// @match        *://mcseas.club/*
// @require      https://unpkg.com/heti/umd/heti-addon.min.js
// @resource     css  https://unpkg.com/heti/umd/heti.min.css
// @grant        GM_addStyle
// @grant        GM_deleteValue
// @grant        GM_getResourceText
// @grant        GM_getValue
// @grant        GM_listValues
// @grant        GM_log
// @grant        GM_openInTab
// @grant        GM_registerMenuCommand
// @grant        GM_setValue
// @grant        GM_unregisterMenuCommand
// ==/UserScript==

(function () {
	'use strict';

	var k=Object.defineProperty;var S=(e,t,n)=>t in e?k(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n;var a=(e,t,n)=>(S(e,typeof t!="symbol"?t+"":t,n),n);var c=(()=>typeof GM_addStyle<"u"?GM_addStyle:void 0)(),z=(()=>typeof GM_deleteValue<"u"?GM_deleteValue:void 0)(),x=(()=>typeof GM_getResourceText<"u"?GM_getResourceText:void 0)(),l=(()=>typeof GM_getValue<"u"?GM_getValue:void 0)(),w=(()=>typeof GM_listValues<"u"?GM_listValues:void 0)(),I=(()=>typeof GM_log<"u"?GM_log:void 0)(),V=(()=>typeof GM_openInTab<"u"?GM_openInTab:void 0)(),_=(()=>typeof GM_registerMenuCommand<"u"?GM_registerMenuCommand:void 0)(),M=(()=>typeof GM_setValue<"u"?GM_setValue:void 0)(),$=(()=>typeof GM_unregisterMenuCommand<"u"?GM_unregisterMenuCommand:void 0)(),C=(()=>window)();const T="lawful-mcseas",q="0.3.2",j="module",D={dev:"vite",build:"tsc && vite build",preview:"vite preview"},E={typescript:"^5.1.6","unplugin-auto-import":"^0.16.6",vite:"^4.4.8","vite-plugin-monkey":"^3.4.0"},H={name:T,private:!0,version:q,type:j,scripts:D,devDependencies:E};class U{current(){const t=new Date,n=(s,y=2,G="0")=>s.toString().padStart(y,G);return [n(t.getFullYear(),4),n(t.getMonth()),n(t.getDate())].join("-")+" "+[n(t.getHours()),n(t.getMinutes()),n(t.getSeconds())].join(":")}debug(...t){I(`${this.current()} | DEBUG |`,...t);}log(...t){console.log(`${this.current()} [ç§©åºå¿ƒæµ·]`,...t);}}class A{constructor(){a(this,"version",`${H.version}-alpha`);a(this,"auto_format");a(this,"font_name");a(this,"font_size");a(this,"only_format_lz");a(this,"block_ip_warning");a(this,"block_email_warning");this.load();}load(){this.auto_format=l("cfg_auto_format")!=="false",this.font_name=l("cfg_font_name")||"å°èµ–å­—ä½“ ç­‰å®½ SC",this.font_size=Number(l("cfg_font_size")),this.font_size=this.font_size>0?this.font_size:16,this.only_format_lz=l("cfg_only_format_lz")!=="false",this.block_ip_warning=l("cfg_block_ip_warning")==="true",this.block_email_warning=l("cfg_block_email_warning")==="true";}save(t,n){M(`cfg_${t}`,n),this.load();}}const i=new U,o=new A;i.debug("lawful-mcseas è„šæœ¬å¼€å‘ä¸­...");i.debug("GM_listValues()",w());i.log("è„šæœ¬å½“å‰ç‰ˆæœ¬:",o.version);i.log("è‡ªåŠ¨æ ¼å¼åŒ–æ­£æ–‡:",o.auto_format);i.log(`è‡ªåŠ¨æ ¼å¼åŒ–æ—¶ æ­£æ–‡å­—ä½“: "${o.font_name}"`);i.log(`è‡ªåŠ¨æ ¼å¼åŒ–æ—¶ æ­£æ–‡å­—ä½“å¤§å°: ${o.font_size} px`);i.log("åªæ ¼å¼åŒ–ä¸€æ¥¼:",o.only_format_lz);i.log("è‡ªåŠ¨å±è”½å¼‚åœ° IP ç™»å½•æé†’:",o.block_ip_warning);let u=setInterval(()=>{setTimeout(L,0);},50),f=0;function L(){f+=1,f>50&&clearInterval(u);let e=document.querySelector("button#fwin_dialog_submit");e&&(e.click(),clearInterval(u));}let r={click_num:void 0,auto_format:void 0,format_font_name:void 0,format_font_size:void 0,switch_ip_warning:void 0,go_to_report:void 0,reset_config:void 0};const d=()=>{Object.values(r).forEach(e=>{e&&$(e);}),r.click_num=_("ðŸ‘† ç‚¹å‡»äº† "+l("click_num",0)+" æ¬¡",()=>{M("click_num",l("click_num",0)+1),d();}),r.auto_format=_((o.auto_format?"âœ”ï¸ å·²å¯ç”¨":"âŒ å·²ç¦ç”¨")+"è‡ªåŠ¨æ ¼å¼åŒ–æ­£æ–‡",()=>{o.save("auto_format",o.auto_format?"false":"true"),i.log((o.auto_format?"âœ”ï¸ å·²å¯ç”¨":"âŒ å·²ç¦ç”¨")+"è‡ªåŠ¨æ ¼å¼åŒ–æ­£æ–‡"),window.location.reload();}),o.auto_format&&(r.format_font_name=_(`ã€€â”œâ”€ ðŸ—š å­—ä½“: "${o.font_name}"`,()=>{const e=prompt("è¯·è¾“å…¥è‡ªå®šä¹‰å­—ä½“åç§° (éœ€è¦ç”µè„‘é‡Œå·²ç»å®‰è£…å¥½çš„å­—ä½“):",o.font_name);e?(o.save("font_name",e),i.log(`å­—ä½“è®¾ç½®ä¸º: "${e}"`),window.location.reload()):i.debug("ç”¨æˆ·å–æ¶ˆè¾“å…¥");}),r.format_font_size=_(`ã€€â””â”€ ðŸ—š å­—ä½“å¤§å°: ${o.font_size} px`,()=>{const e=Number(prompt("è¯·è¾“å…¥è‡ªå®šä¹‰å­—ä½“å¤§å°, å•ä½ä¸ºåƒç´ (px):",String(o.font_size)));e>0?(o.save("font_size",String(e)),i.log(`å­—ä½“å¤§å°è®¾ç½®ä¸º: ${e} px`),window.location.reload()):i.debug("ç”¨æˆ·å–æ¶ˆè¾“å…¥");})),r.switch_ip_warning=_((o.block_ip_warning?"âŒ å·²ç¦ç”¨":"âœ”ï¸ å·²å¯ç”¨")+"å¼‚åœ° IP ç™»å½•æé†’",()=>{o.save("block_ip_warning",o.block_ip_warning?"false":"true"),i.log((o.block_ip_warning?"âŒ å·²ç¦ç”¨":"âœ”ï¸ å·²å¯ç”¨")+"å¼‚åœ° IP ç™»å½•æé†’"),d();}),r.go_to_report=_("ðŸ†• æå‡ºéœ€æ±‚ & åé¦ˆ BUG",()=>{V("https://mcseas.club/forum.php?mod=viewthread&tid=50579",!1);}),r.reset_config=_("ðŸ†‘ é‡ç½®æ‰€æœ‰é…ç½®é¡¹",()=>{w().forEach(e=>{z(e);}),window.location.reload();});};d();if(o.block_ip_warning){let e=function(){n+=1,n>50&&clearInterval(t);let s=document.querySelectorAll("#ip_notice .bm_h a");s.length===1&&(s[0].click(),clearInterval(t));},t=setInterval(()=>{setTimeout(e,0);},50),n=0;}const m=window.location.href.match(/[&#]pid=?(\d+)/i);var p;if(m!==null){const e=m[1];let t=document.querySelector(`#pid${e}`);t&&((p=t.querySelector("td.plc"))==null||p.classList.add("highlight-card"),c(".highlight-card { background-color: #dedbcc; color: #363636; -moz-box-shadow: 0.075rem 0.125rem 0.25rem rgba(0, 0, 0, 0.5); -webkit-box-shadow: 0.075rem 0.125rem 0.25rem rgba(0, 0, 0, 0.5); box-shadow: 0.075rem 0.125rem 0.25rem rgba(0, 0, 0, 0.5); } .highlight-card:hover { -webkit-box-shadow: 0 0.325rem 1.75rem rgba(0, 0, 0, 0.3); -moz-box-shadow: 0 0.325rem 1.75rem rgba(0, 0, 0, 0.3); box-shadow: 0 0.325rem 1.75rem rgba(0, 0, 0, 0.3); }"));}var v;(v=document.querySelector("#append_parent"))==null||v.classList.add("heti-parent");let g=document.querySelectorAll("div#pt > div.z > a");var b,h;if(g.length>4&&["åŽŸåˆ›æ–‡å­¦","å®¡æ ¸åŒº"].includes(g[3].innerText)){let e=document.querySelectorAll("table.plhin td.plc");for(let t=0;t<e.length&&!(o.only_format_lz&&((b=e[t].querySelector("div.pi > strong > a"))==null?void 0:b.innerText.trim())!=="æˆ˜åˆ—èˆ°");t++)(h=e[t].querySelector(".t_f"))==null||h.classList.add("heti");}if(o.auto_format){const e=[c(x("css")),c(`.heti, .heti-parent .pcb { font-family: "${o.font_name}", "Helvetica Neue", helvetica, arial, "Heti Hei", sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol"; font-size: ${o.font_size}px; }`)];i.debug("æ‰§è¡Œè‡ªåŠ¨æ ¼å¼åŒ– æ–°å¢ž CSS",e),window.onload=()=>{new C.Heti(".heti, .heti-parent .pcb").autoSpacing();};}

})();